# MT4/5 å¤šè´¦æˆ·å®žæ—¶ç›‘æŽ§ç³»ç»Ÿ - v2.1 PnL å¢žå¼ºç‰ˆ

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ”¯æŒçš„æ‰€æœ‰è´¦æˆ·ç±»åž‹

| ç±»åž‹ | æ ‡è¯† | PnL è¿½è¸ª | ç‰¹æ®ŠåŠŸèƒ½ |
|------|------|---------|----------|
| **FTMO 1-Step** | ðŸ”¥ PROP_FTMO + `is_ftmo_1step: true` | âœ… | æµ®åŠ¨é™é¢ + Best Day |
| FTMO 2-Step | PROP_FTMO | âœ… | å›ºå®šé™é¢ç›‘æŽ§ |
| **Cent è´¦æˆ·** | CENT | âœ… | è‡ªåŠ¨ç¾Žå…ƒè½¬æ¢ |
| **Darwinex** | PROP_DARWINEX | âœ… | å¯æ‰©å±• D-Score |
| **å®žç›˜è´¦æˆ·** | LIVE | âœ… | å®Œæ•´ PnL ç»Ÿè®¡ |
| **æ¨¡æ‹Ÿè´¦æˆ·** | DEMO | âœ… | å®Œæ•´ PnL ç»Ÿè®¡ |

### PnL ç»Ÿè®¡åŠŸèƒ½

| ç»Ÿè®¡é¡¹ | è¯´æ˜Ž |
|--------|------|
| **ä»Šæ—¥ç›ˆäº** | å½“æ—¥å·²å®žçŽ° + æµ®åŠ¨ç›ˆäº |
| **æœ¬å‘¨ç›ˆäº** | æœ€è¿‘7å¤©æ±‡æ€» |
| **æœ¬æœˆç›ˆäº** | æœ€è¿‘30å¤©æ±‡æ€» |
| **æ€»ç›ˆäº** | ä»Žåˆå§‹èµ„é‡‘è‡³ä»Š |
| **èƒœçŽ‡** | ç›ˆåˆ©å¤©æ•° / æ€»äº¤æ˜“å¤©æ•° |
| **æœ€å¤§å›žæ’¤** | å•æ—¥æœ€å¤§äºæŸé‡‘é¢/ç™¾åˆ†æ¯” |
| **å¤æ™®æ¯”çŽ‡** | å¹´åŒ–é£Žé™©è°ƒæ•´åŽæ”¶ç›Š |
| **æ—¥å‡ç›ˆäº** | æ€»ç›ˆäº / äº¤æ˜“å¤©æ•° |

### PnL é¢„è­¦åŠŸèƒ½

å¯åœ¨ EA å‚æ•°ä¸­è®¾ç½®ï¼š
```
å¯ç”¨ç›ˆäºè¿½è¸ª: true
å•æ—¥äºæŸé¢„è­¦ %: 5        # ä»Šæ—¥äºæŸ â‰¥ 5% è§¦å‘é¢„è­¦
å•æ—¥ç›ˆåˆ©é¢„è­¦ %: 0        # ä»Šæ—¥ç›ˆåˆ© â‰¥ X% è§¦å‘é¢„è­¦ (0=å…³é—­)
```

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. ä¸­å¤®æœåŠ¡å™¨éƒ¨ç½²

```bash
cd ~/clawd/mt4_monitor
pip install fastapi uvicorn pyzmq websockets
python3 server.py
```

è®¿é—®ï¼š`http://your-server-ip:8000`

### 2. MT4/5 EA éƒ¨ç½²

#### å®‰è£… ZeroMQ åº“
- ä¸‹è½½ [ZeroMQ for MT5](https://www.mql5.com/en/code/43672)
- å°† `ZmqSocket.mqh` æ”¾å…¥ `MQL5/Include/zmq/`

#### ç¼–è¯‘å¹¶é™„åŠ  EA
```
1. AccountMonitorEA.mq5 â†’ MQL5/Experts/
2. æŒ‰ F7 ç¼–è¯‘
3. é™„åŠ åˆ°å›¾è¡¨
```

---

## ðŸ”§ è´¦æˆ·é…ç½®ç¤ºä¾‹

### å®žç›˜è´¦æˆ· (LIVE)
```
=== è´¦æˆ·é…ç½® ===
è´¦æˆ·åç§°: ICMarkets-Live-1
è´¦æˆ·ç±»åž‹: LIVE
æ˜¯å¦ä¸ºCentè´¦æˆ·: false
å¯ç”¨FTMO 1-Stepè§„åˆ™: false

=== ç›ˆäºé¢„è­¦ ===
å¯ç”¨ç›ˆäºè¿½è¸ª: true
å•æ—¥äºæŸé¢„è­¦ %: 5        # å½“æ—¥äºæŸè¶…è¿‡5%é¢„è­¦
å•æ—¥ç›ˆåˆ©é¢„è­¦ %: 0        # ä¸è®¾ç½®ç›ˆåˆ©é¢„è­¦

=== æœåŠ¡å™¨é…ç½® ===
ä¸­å¤®æœåŠ¡å™¨IP: your-server-ip
æœåŠ¡å™¨ç«¯å£: 5555
```

### Cent è´¦æˆ·
```
è´¦æˆ·åç§°: Exness-Cent-1
è´¦æˆ·ç±»åž‹: CENT
æ˜¯å¦ä¸ºCentè´¦æˆ·: true           â† å¼€å¯è‡ªåŠ¨è½¬æ¢
å¯ç”¨ç›ˆäºè¿½è¸ª: true
å•æ—¥äºæŸé¢„è­¦ %: 5
```

### FTMO 1-Step æŒ‘æˆ˜
```
=== è´¦æˆ·é…ç½® ===
è´¦æˆ·åç§°: FTMO-50K-Account-1
è´¦æˆ·ç±»åž‹: PROP_FTMO
æŒ‘æˆ˜è§„æ¨¡: 50000

=== FTMO 1-Step è§„åˆ™ ===
å¯ç”¨FTMO 1-Stepè§„åˆ™: true      â† å…³é”®ï¼
æœ€å¤§æ—¥æŸ %: 3
æœ€å¤§æ€»æŸ %: 10
åˆ©æ¶¦ç›®æ ‡ %: 10

=== ç›ˆäºé¢„è­¦ ===
å¯ç”¨ç›ˆäºè¿½è¸ª: true
å•æ—¥äºæŸé¢„è­¦ %: 3        # å»ºè®®ä¸ŽFTMOæ—¥æŸä¸€è‡´
```

---

## ðŸ“Š ä»ªè¡¨ç›˜ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“Š MT4/5 ç›‘æŽ§ä¸­å¿ƒ               åœ¨çº¿: 8    ç¦»çº¿: 1            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€»å‡€å€¼      ä»Šæ—¥ç›ˆäº     æœ¬å‘¨ç›ˆäº    æœ¬æœˆç›ˆäº   æ€»ç›ˆäº  é£Žé™©  â”‚
â”‚  $523,456   +$3,240      +$12,500   +$45,200  +$78K    1     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å…¨éƒ¨] [å®žç›˜] [Cent] [FTMO] [Darwinex]                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è´¦æˆ·         å‡€å€¼/ç›®æ ‡    ä»Šæ—¥ç›ˆäº  æœ¬å‘¨ç›ˆäº  æ€»ç›ˆäº   èƒœçŽ‡   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ICMarkets-1  $125,234    +$1,234   +$5,600   +$25K   65%    â”‚
â”‚  ðŸŸ¢ å®žç›˜                 +1.0%                                       â”‚
â”‚                                                               â”‚
â”‚  FTMO-50K-1   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘   +$850    +$2,400   $0      100%   â”‚
â”‚  ðŸ”¥ FTMO 1-STEP 92%      +1.7%     (é€šè¿‡ä¸­)                         â”‚
â”‚                                                               â”‚
â”‚  Exness-Cent  $12,500     -$625    -$800    +$1,200  55%    â”‚
â”‚  ðŸŸ¡ CENT                 -5.0% âš ï¸ é¢„è­¦                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»ªè¡¨ç›˜ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜Ž |
|------|------|
| **å®žæ—¶æ›´æ–°** | WebSocket 5ç§’åˆ·æ–° |
| **é¢œè‰²æ ‡è¯†** | ç»¿è‰²=ç›ˆåˆ©, çº¢è‰²=äºæŸ, æ©™è‰²=é¢„è­¦ |
| **æ±‡æ€»å¡ç‰‡** | æ‰€æœ‰è´¦æˆ·æ€»å‡€å€¼å’Œç›ˆäºç»Ÿè®¡ |
| **ç­›é€‰å™¨** | æŒ‰è´¦æˆ·ç±»åž‹å¿«é€Ÿè¿‡æ»¤ |
| **é£Žé™©è­¦å‘Š** | äºæŸè¶…é™æˆ–FTMOè¿è§„æ—¶é—ªçƒæç¤º |

---

## ðŸ“ˆ PnL æ•°æ®å­˜å‚¨

EA ä¼šè‡ªåŠ¨ä¿å­˜æ¯æ—¥ç›ˆäºåŽ†å²åˆ°æœ¬åœ°æ–‡ä»¶ï¼š
- æ–‡ä»¶ä½ç½®: `MQL5/Common/Files/AccountName_history.csv`
- åŒ…å«å­—æ®µ: æ—¥æœŸ, èµ·å§‹ä½™é¢, æ”¶ç›˜ä½™é¢, å¹³ä»“ç›ˆäº, æµ®åŠ¨ç›ˆäº, æ€»ç›ˆäº
- ç”¨äºŽè®¡ç®—: èƒœçŽ‡ã€æœ€å¤§å›žæ’¤ã€å¤æ™®æ¯”çŽ‡ã€å‘¨/æœˆç»Ÿè®¡

---

## ðŸ”¥ ç”Ÿäº§éƒ¨ç½²

### systemd æœåŠ¡

```bash
sudo tee /etc/systemd/system/mt4-monitor.service > /dev/null << EOF
[Unit]
Description=MT4/5 Account Monitor
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/mt4_monitor
ExecStart=/usr/bin/python3 /home/ubuntu/mt4_monitor/server.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl enable mt4-monitor
sudo systemctl start mt4-monitor
```

### é˜²ç«å¢™é…ç½®

```bash
sudo ufw allow 5555/tcp   # ZeroMQ æ•°æ®æŽ¥æ”¶
sudo ufw allow 8000/tcp   # Web ä»ªè¡¨ç›˜
```

---

## ðŸ“¡ API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/` | GET | ä¸»ä»ªè¡¨ç›˜é¡µé¢ |
| `/api/accounts` | GET | æ‰€æœ‰è´¦æˆ·æ•°æ® (å«å®Œæ•´ PnL) |
| `/api/accounts/{name}/history?hours=24` | GET | è´¦æˆ·åŽ†å²æ•°æ® |
| `/ws` | WS | WebSocket å®žæ—¶æŽ¨é€ |

### è´¦æˆ·æ•°æ®ç»“æž„

```json
{
  "account_name": "FTMO-50K-1",
  "is_ftmo_1step": true,
  "equity": 55234.50,
  "initial_balance": 50000.00,
  
  // PnL ç»Ÿè®¡
  "today_pnl": 850.00,
  "today_pnl_pct": 1.7,
  "week_pnl": 2400.00,
  "month_pnl": 8500.00,
  "total_pnl": 5234.50,
  "total_pnl_pct": 10.47,
  "win_rate": 72.5,
  "profitable_days": 29,
  "losing_days": 11,
  "max_drawdown": 1200.00,
  "max_drawdown_pct": 2.4,
  "sharpe_ratio": 1.85,
  "trading_days": 40,
  
  // é£Žé™©çŠ¶æ€
  "daily_loss_risk": "safe",
  "total_loss_risk": "safe",
  "pnl_alert_triggered": false
}
```

---

## âš ï¸ æ•…éšœæŽ’æŸ¥

### EA è¿žæŽ¥ä¸ä¸ŠæœåŠ¡å™¨
```bash
1. æ£€æŸ¥æœåŠ¡å™¨ IP å’Œç«¯å£ 5555
2. ç¡®è®¤é˜²ç«å¢™å·²å¼€æ”¾
3. æŸ¥çœ‹ EA æ—¥å¿— (Experts tab)
4. ç¡®ä¿ ZeroMQ åº“æ­£ç¡®å®‰è£…
```

### PnL æ•°æ®ä¸å‡†ç¡®
- EA æ¯å¤©åˆå¤œè‡ªåŠ¨ä¿å­˜å½“æ—¥æ•°æ®
- å¦‚æžœè·¨æ—¥æ—¶é—´æ®µå†…å…³é—­ MT4/5ï¼Œæ•°æ®å¯èƒ½ä¸å®Œæ•´
- å»ºè®®è®© MT4/5 24å°æ—¶è¿è¡Œï¼Œæˆ–ä½¿ç”¨ VPS

### åŽ†å²æ•°æ®ä¸¢å¤±
- æ›´æ¢ VPS æ—¶éœ€å¤åˆ¶ `*_history.csv` æ–‡ä»¶
- æ–‡ä»¶ä½ç½®: `MQL5/Common/Files/`

---

## ðŸ“ ç‰ˆæœ¬åŽ†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| v2.1 | 2026-02-12 | æ·»åŠ å®Œæ•´ PnL ç»Ÿè®¡ + ç›ˆäºé¢„è­¦ |
| v2.0 | 2026-02-12 | å®Œæ•´ FTMO 1-Step æ”¯æŒ |
| v1.0 | 2026-02-12 | åˆå§‹ç‰ˆæœ¬ï¼šåŸºç¡€ç›‘æŽ§ |

---

## ðŸ’¡ ä½¿ç”¨æŠ€å·§

1. **å¤šè´¦æˆ·å‘½å**: å»ºè®® `å¹³å°-ç±»åž‹-åºå·`ï¼Œå¦‚ `ICMarkets-Live-1`
2. **é¢„è­¦è®¾ç½®**: å®žç›˜å»ºè®® 5%ï¼ŒFTMO å»ºè®®ä¸Žè§„åˆ™ä¸€è‡´ (3%)
3. **ç§»åŠ¨ç«¯**: ä»ªè¡¨ç›˜è‡ªé€‚åº”ï¼Œæ‰‹æœºéšæ—¶æŸ¥çœ‹
4. **æ•°æ®å¤‡ä»½**: å®šæœŸå¤‡ä»½ `mt4_monitor.db` å’Œ `*_history.csv`
5. **ç›‘æŽ§é¢‘çŽ‡**: é»˜è®¤5ç§’ï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´ (1-60ç§’)
